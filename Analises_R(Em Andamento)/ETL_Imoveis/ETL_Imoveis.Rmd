---
title: "Análise venda de imóveis"
author: "Jairo Lopes"
output: rmdformats::readthedown
css: "style.css"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggthemes)
library(GGally)
library(RColorBrewer)
options(scipen = 999)

df <- read_csv("House.csv")
colnames(df) <- c('media de lucro de venda', 'media idade das casas', 'media numero de salas','media numero de quartos', 'populacao da regiao', 'valor da casa', 'endereco')
```

# Resumo
Este projeto fará uma breve análise exploratória dos dados de um dataset de venda de casas, para realizar a predição de preços de novas casas com caracteristicas semelhantes as ja vendidas



# Visão geral do dataset
Verificando quantidade de registros e de colunas respectivamente do conjunto de dados

```{r}
df %>% str %>% knitr::kable()
```


```{r}
df %>% head(4) %>% knitr::kable()
```


___



# Visualizando a distribuição de preços das casas por quantidade de quartos


```{r}


ggplot(df, aes(x=df$`media numero de quartos`, y=df$`valor da casa`)) + geom_point(color="cyan4") + theme_calc() +
  
labs(x="Numero de quartos",y="Valor da casa", parse = F, colour = "black", size = 12,family="Times New Roman") +
theme(text=element_text(size=14, family="Times New Roman", colour="black"), axis.text=element_text(family="Times New Roman", size=14,colour="black"))
```


**OBS:** Não há grande variação de preço por numero de quartos, mas da pra perceber que casas que contém em media 2 quartos, são um pouco mais baratas em seu **valor máximo**


___



# Visualizando a distribuição de preços das casas por quantidade de salas

```{r}
ggplot(df, aes(x = df$`media numero de salas`, y=df$`valor da casa`)) + geom_point(color="dodgerblue3") + theme_gdocs() +
scale_x_continuous(breaks = seq(3, 11, by=1)) +
  
labs(x="Numero de salas",y="Valor da casa", parse = F, colour = "black", size = 12,family="Times New Roman") +
theme(text=element_text(size=14, family="Times New Roman", colour="black"), axis.text=element_text(family="Times New Roman", size=14,colour="black"))
```

**OBS:** obviamente, quanto maior a quantidade de salas, maior o preço da casa, em alguns poucos casos, casas com numero menor de salas sao mais caras

**OBS 2:** Também é possivel notar que a grande maioria das casas possuem entre 6 a 8 salas


___



# Visualizando a distribuição de salas por quantidade de quartos


```{r}
ggplot(df, aes(x=df$`media numero de quartos`, y=df$`media numero de salas`)) + geom_point(color="hotpink4") + theme_gdocs() +

labs(x="Numero de quartos",y="Numero de salas", parse = F, colour = "black", size = 12,family="Times New Roman") +
theme(text=element_text(size=14, family="Times New Roman", colour="black"), axis.text=element_text(family="Times New Roman", size=14,colour="black"))
```


**OBS:** Podemos ver que todas as casas com 5 quartos ou mais, possuem no mínimo 7 salas

**OBS 2:** Também observamos que casas com 2 quartos, possuem no maximo 7 salas


___



# Visualizando distribuição do preço da casa baseado pela idade da mesma


```{r}
ggplot(df, aes(x=df$`media idade das casas`, y=df$`valor da casa`)) + geom_point(color="magenta4") + theme_gdocs() +
scale_x_continuous(breaks = seq(0,10,1)) +
labs(x="Idade do imóvel",y="Valor", parse = F, colour = "black", size = 12,family="Times New Roman") +
theme(text=element_text(size=14, family="Times New Roman", colour="black"), axis.text=element_text(family="Times New Roman", size=14,colour="black"))
```


**OBS:** E mais uma amostra linear onde indica que, quanto mais velha a casa, maior o seu valor


___


# Visualizando distribuição de preços da casa por tamanho da população da região

```{r}
ggplot(df, aes(y=df$`valor da casa`, x=df$`populacao da regiao`)) + geom_point(color="dodgerblue3") + theme_gdocs() +
labs(x="População da região",y="Valor do imóvel", parse = F, colour = "black", size = 12,family="Times New Roman") +
theme(text=element_text(size=14, family="Times New Roman", colour="black"), axis.text=element_text(family="Times New Roman", size=14,colour="black"))
```


**OBS:** Quanto maior a população da região, maior o valor do imóvel



___



# Visualizando correlações entre as variáveis


```{r}
ggcorr(df, label = T, hjust = 0.85)
```

**OBS:** As maiores correlações com a variavel "valor da casa" sao: **populacao da regiao, idade da casa, lucro de venda e numero de salas** 


___

# Machine Learning

## Filtrando variáveis significantes para o modelo
Três modelos serão criados, o **modelo1** com as variaveis `lucro de venda` e `idade das casas`.

O **modelo2** com as variaveis `lucro de venda`, `idade das casas` e `populacao da regiao`.

O **modelo3** com as variaveis `lucro de venda`, `idade das casas`, `populacao da regiao` e `numero de salas`.


```{r}
modelo1 <- lm(`valor da casa` ~ -1 + `media de lucro de venda` + `media idade das casas`, data = df)
modelo2 <- lm(`valor da casa` ~ -1 + `media de lucro de venda` + `media idade das casas` + `populacao da regiao`, data = df)
modelo3 <- lm(`valor da casa` ~ -1 + `media de lucro de venda` + `media idade das casas` + `populacao da regiao` + `media numero de salas`, data = df)

```

# Avaliando desempenho de cada modelo {.tabset}
## Modelo1
```{r}
modelo1 %>% summary
```

**OBS 1: **Quase **96%** dos dados do valor da casa, podem ser explicados pelas variáveis preditoras escolhidas

**OBS 2: **Também e perceptivel que a margem de erros das duas variáveis são proximas a zero

___

## Modelo2
```{r}
modelo2 %>% summary
```

**OBS 1: ** **96,43%** dos dados do valor da casa, podem ser explicados pelas variáveis preditoras escolhidas

**OBS 2: **Também e perceptivel que a margem de erros das **três** variáveis são proximas a zero

___

## Modelo3
```{r}
modelo3 %>% summary
```

**OBS 1: ** Não há diferença se comparado ao modelo dois no que diz respeito a explicação dos dados

**OBS 2: **É notavel que a variavel "numero de salas" tem uma margem de erro consideravelmente maior que as outras 3 variaveis

___

# Visualizando o desempenho das predições dos 3 modelos {.tabset}
Será comparado os resultados estimados com os resultados originais em um gráfico de dispersão.

## Predições do modelo 1

```{r}
pred1 <- tibble(dadosReais=df$`valor da casa`, predicoes=modelo1$fitted.values, residuosPadronizados=rstandard(modelo1))

ggplot(pred1, aes(x=dadosReais, y=predicoes)) + geom_point(color="seagreen4") + theme_gdocs()
```

**OBS: **Criado com as variáveis `valor da casa`, `media de lucro de venda` e `media idade das casas`

___

## Predições do modelo 2

```{r}
pred2 <- tibble(N=1:5000, dadosReais=df$`valor da casa`, predicoes=modelo2$fitted.values, residuos=modelo2$residuals, residuosPadronizados=rstandard(modelo2))

ggplot(pred2, aes(x=dadosReais, y=predicoes)) + geom_point(color="seagreen4") + theme_gdocs()
```

**OBS: **Criado com as variáveis `valor da casa` e `media de lucro de venda`

___

## Predições do modelo 3

```{r}
pred3 <- tibble(dadosReais=df$`valor da casa`, predicoes=modelo3$fitted.values, residuosPadronizados=rstandard(modelo3))

ggplot(pred3, aes(x=dadosReais, y=predicoes)) + geom_point(color="seagreen4") + theme_gdocs()
```

**OBS: **Criado com as variáveis `valor da casa`, `media de lucro de venda`, `media idade das casas`, `populacao da regiao`, `media numero de salas`

___

# Observações sobre as predições
Claramente o modelo2 teve um desempenho melhor, justamente por possuir as duas variáveis de maior correlação com a variável valor da casa

___

# Verificando possiveis outliers do melhor modelo
Foi filtrado todos os residuos padronizados com valor maior ou igual a **1.96**, ou, menor ou igual **-1.96**

```{r}
pred2 %>% filter(residuosPadronizados >= 1.96 | residuosPadronizados <= -1.96) %>% nrow()
```
**OBS:** Dos 5 mil registros, 241 são outliers

___


# Comparando desempenho do modelo2 com e sem outliers
Armazenando a identificação dos outliers identificados dentro de uma variavel vetor, e usando esta variavel para remover os outliers do modelo.

```{r}
outliers <- pred2 %>% filter(residuosPadronizados >= 1.96 | residuosPadronizados <= -1.96) %>% select(N)
outliers <- outliers$N

reaisSemOutliers <- df$`valor da casa`[-outliers]
predSemOutliers <- modelo2$fitted.values[-outliers]
semOutliers <- tibble(dadosReais=reaisSemOutliers, predicoes=predSemOutliers)

modelo2SemOut <- ggplot(semOutliers, aes(x=dadosReais, y=predicoes)) + geom_point(color="deeppink4") + theme_gdocs()

modelo2ComOut <- ggplot(pred2, aes(x=dadosReais, y=predicoes)) + geom_point(color="deeppink4") + theme_gdocs()
  
```

# Visualizando o desempenho do modelo2 com e sem outliers {.tabset}

## Modelo2 COM outliers
```{r}
modelo2ComOut + guides(size = FALSE) + theme(plot.margin = margin(1,.8,2,.8, "cm"))
```

**OBS:** Extremidades mais dispersas.

___


## Modelo2 SEM outliers

```{r}
modelo2SemOut +  guides(size = FALSE) + theme(plot.margin = margin(2.5,.8,2,.8, "cm"))
```

**OBS:** Extremidades mais concentradas

___



